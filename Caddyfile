{
    # Email for Let's Encrypt certificates
    email aidansjamai99@gmail.com
    
    # Minimal logging for production (errors only)
    # Keep some logging for troubleshooting SSL certificate issues
    log {
        level ERROR
    }
    
    # Disable admin API for security and resource savings
    admin off
}

# Redirect HTTP to HTTPS
http://paper-trader.net {
    redir https://paper-trader.net{uri} permanent
}

paper-trader.net {
    # Security headers
    header {
        # HSTS - Force HTTPS for 1 year
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        
        # Prevent MIME type sniffing
        X-Content-Type-Options "nosniff"
        
        # Prevent clickjacking
        X-Frame-Options "DENY"
        
        # XSS protection (legacy but still useful)
        X-XSS-Protection "1; mode=block"
        
        # Referrer policy
        Referrer-Policy "strict-origin-when-cross-origin"
        
        # Cross-Origin-Opener-Policy - Allow OAuth popups
        Cross-Origin-Opener-Policy "same-origin-allow-popups"
        
        # Content Security Policy
        Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://accounts.google.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:; connect-src 'self' https://api.marketstack.com https://accounts.google.com https://www.googleapis.com;"
        
        # Remove server header for security
        -Server
    }

    # API routes - proxy to backend
    handle /api/* {
        reverse_proxy backend:8080 {
            # Connection timeouts for backend requests
            transport http {
                dial_timeout 10s
                response_header_timeout 30s
            }
        }
    }

    # Frontend routes - proxy to frontend
    handle /* {
        reverse_proxy frontend:80 {
            header_up Accept-Encoding identity
            # Timeouts for frontend requests
            transport http {
                dial_timeout 10s
                response_header_timeout 30s
            }
        }
    }
}